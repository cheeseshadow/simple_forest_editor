var ke=Object.defineProperty;var re=t=>{throw TypeError(t)};var De=(t,e,n)=>e in t?ke(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var k=(t,e,n)=>De(t,typeof e!="symbol"?e+"":e,n),Le=(t,e,n)=>e.has(t)||re("Cannot "+n);var T=(t,e,n)=>(Le(t,e,"read from private field"),n?n.call(t):e.get(t)),X=(t,e,n)=>e.has(t)?re("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n);import{t as O,a as F}from"../chunks/CwYYdo5Y.js";import{i as te}from"../chunks/CrteNLGQ.js";import{a4 as Pe,n as Ie,C as Q,w as E,$ as Re,z as Te,g as r,O as fe,A as Ae,B as ie,D as Z,x as J,af as Ne,F as ge,o as he,G as Fe,ap as $,aj as pe,a3 as oe,aq as Oe,Y as L,ar as le,a9 as Me,as as je,at as Je,ai as Be,au as He,v as Ue,av as Ye,aw as ze,ac as Xe,am as ee,X as C,p as ne,k as A,m as P,s as B,t as me,j as se,i as Ge,y as qe,ax as q,ay as Ve}from"../chunks/D7k1Uvis.js";import{d as ae,s as de,e as We,a as Ke}from"../chunks/CSpAqOmT.js";import{p as S,b as V,i as ce}from"../chunks/D1DJzFZd.js";import{o as _e,a as Qe}from"../chunks/C_cJQfJi.js";function Ze(t,e,n,s){for(var c=[],d=e.length,h=0;h<d;h++)Je(e[h].e,c,!0);var _=d>0&&c.length===0&&n!==null;if(_){var p=n.parentNode;Be(p),p.append(n),s.clear(),D(t,e[0].prev,e[d-1].next)}He(c,()=>{for(var m=0;m<d;m++){var i=e[m];_||(s.delete(i.k),D(t,i.prev,i.next)),Ue(i.e,!_)}})}function $e(t,e,n,s,c,d=null){var h=t,_={flags:e,items:new Map,first:null};{var p=t;h=E?Q(Re(p)):p.appendChild(Pe())}E&&Te();var m=null,i=!1,g=fe(()=>{var a=n();return Me(a)?a:a==null?[]:pe(a)});Ie(()=>{var a=r(g),u=a.length;if(i&&u===0)return;i=u===0;let o=!1;if(E){var x=h.data===Ae;x!==(u===0)&&(h=ie(),Q(h),Z(!1),o=!0)}if(E){for(var b=null,f,y=0;y<u;y++){if(J.nodeType===8&&J.data===Ne){h=J,o=!0,Z(!1);break}var v=a[y],l=s(v,y);f=ye(J,_,b,null,v,l,y,c,e,n),_.items.set(l,f),b=f}u>0&&Q(ie())}E||et(a,_,h,c,e,s,n),d!==null&&(u===0?m?ge(m):m=he(()=>d(h)):m!==null&&Fe(m,()=>{m=null})),o&&Z(!0),r(g)}),E&&(h=J)}function et(t,e,n,s,c,d,h){var _=t.length,p=e.items,m=e.first,i=m,g,a=null,u=[],o=[],x,b,f,y;for(y=0;y<_;y+=1){if(x=t[y],b=d(x,y),f=p.get(b),f===void 0){var v=i?i.e.nodes_start:n;a=ye(v,e,a,a===null?e.first:a.next,x,b,y,s,c,h),p.set(b,a),u=[],o=[],i=a.next;continue}if(tt(f,x,y),(f.e.f&$)!==0&&ge(f.e),f!==i){if(g!==void 0&&g.has(f)){if(u.length<o.length){var l=o[0],w;a=l.prev;var I=u[0],M=u[u.length-1];for(w=0;w<u.length;w+=1)ue(u[w],l,n);for(w=0;w<o.length;w+=1)g.delete(o[w]);D(e,I.prev,M.next),D(e,a,I),D(e,M,l),i=l,a=M,y-=1,u=[],o=[]}else g.delete(f),ue(f,i,n),D(e,f.prev,f.next),D(e,f,a===null?e.first:a.next),D(e,a,f),a=f;continue}for(u=[],o=[];i!==null&&i.k!==b;)(i.e.f&$)===0&&(g??(g=new Set)).add(i),o.push(i),i=i.next;if(i===null)continue;f=i}u.push(f),a=f,i=f.next}if(i!==null||g!==void 0){for(var j=g===void 0?[]:pe(g);i!==null;)(i.e.f&$)===0&&j.push(i),i=i.next;var N=j.length;if(N>0){var W=_===0?n:null;Ze(e,j,W,p)}}oe.first=e.first&&e.first.e,oe.last=a&&a.e}function tt(t,e,n,s){Oe(t.v,e),t.i=n}function ye(t,e,n,s,c,d,h,_,p,m){var i=(p&Ye)!==0,g=(p&ze)===0,a=i?g?L(c):le(c):c,u=(p&je)===0?h:le(h),o={i:u,v:a,k:d,a:null,e:null,prev:n,next:s};try{return o.e=he(()=>_(t,a,u,m),E),o.e.prev=n&&n.e,o.e.next=s&&s.e,n===null?e.first=o:(n.next=o,n.e.next=o.e),s!==null&&(s.prev=o,s.e.prev=o.e),o}finally{}}function ue(t,e,n){for(var s=t.next?t.next.e.nodes_start:n,c=e?e.e.nodes_start:n,d=t.e.nodes_start;d!==s;){var h=Xe(d);c.before(d),d=h}}function D(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function nt(t,e){return t==null?null:String(t)}function xe(t,e,n,s){var c=t.__style;if(E||c!==e){var d=nt(e);(!E||d!==t.getAttribute("style"))&&(d==null?t.removeAttribute("style"):t.style.cssText=d),t.__style=e}return s}const st=!0,It=Object.freeze(Object.defineProperty({__proto__:null,prerender:st},Symbol.toStringTag,{value:"Module"})),at=()=>{sessionStorage.clear()},rt=t=>{const e=JSON.stringify(t);sessionStorage.setItem("temp_cards",e)},it=()=>{const t=sessionStorage.getItem("temp_cards");return t?JSON.parse(t):[]},ot=t=>{for(const e of t)be(e.item.id,e.position)},be=(t,e)=>{sessionStorage.setItem("dragndrop"+t,JSON.stringify(e))},lt=t=>{const e=sessionStorage.getItem("dragndrop"+t);return e?JSON.parse(e):null};var H,U,Y;class we{constructor(e=void 0){k(this,"id");X(this,H,ee(0));X(this,U,ee(0));X(this,Y,ee(!1));k(this,"startPosition",{x:0,y:0});k(this,"startDragPosition",{x:0,y:0});k(this,"init",()=>{if(this.id){const e=lt(this.id);e&&(this.x=e.x,this.y=e.y)}});k(this,"startDrag",e=>{e.preventDefault(),e.stopPropagation(),this.dragging=!0,this.startPosition={x:this.x,y:this.y},this.startDragPosition={x:e.clientX,y:e.clientY};const n=c=>{this.updateDrag(c)},s=()=>{window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",s),this.dragging=!1,this.savePosition()};window.addEventListener("mousemove",n),window.addEventListener("mouseup",s),window.addEventListener("mouseleave",s)});k(this,"updateDrag",e=>{const n=e.clientX-this.startDragPosition.x,s=e.clientY-this.startDragPosition.y;this.x=this.startPosition.x+n,this.y=this.startPosition.y+s});k(this,"savePosition",()=>{this.id&&be(this.id,{x:this.x,y:this.y})});this.id=e}get x(){return r(T(this,H))}set x(e){C(T(this,H),e,!0)}get y(){return r(T(this,U))}set y(e){C(T(this,U),e,!0)}get dragging(){return r(T(this,Y))}set dragging(e){C(T(this,Y),e,!0)}get position(){return{x:this.x,y:this.y}}}H=new WeakMap,U=new WeakMap,Y=new WeakMap;const dt=t=>{switch(t){case"female":return"#F7C6D9";case"male":return"#A7C7E7"}},ve=(t,e)=>({x:t.offsetLeft+t.offsetWidth/2+e.x,y:t.offsetTop+t.offsetHeight/2+e.y}),ct=(t,e)=>({x:(t.x+e.x)/2,y:(t.y+e.y)/2}),G=(t,e,n,s=6)=>{e.strokeStyle=n,e.lineWidth=s,e.beginPath();for(const c of t)e.moveTo(c.start.x,c.start.y),e.lineTo(c.end.x,c.end.y);e.stroke()};var ut=(t,e,n)=>e()&&e()(n()),vt=O('<div class="card card-like svelte-7tc914"><div class="name svelte-7tc914"> </div> <div class="job svelte-7tc914"> </div></div>');function ft(t,e){ne(e,!1);let n=S(e,"setElementRef",8),s=L(),c=S(e,"id",8),d=S(e,"name",8),h=S(e,"job",8),_=S(e,"gender",8),p=S(e,"cardSelected",8,!1),m=S(e,"onCardSelected",8,null);const i=dt(_()),g=new we(c().toString());_e(()=>{g.init(),n()(r(s))}),te();var a=vt();a.__mousedown=function(...f){var y;(y=g.startDrag)==null||y.apply(this,f)},a.__click=[ut,m,c];var u=A(a),o=A(u,!0);P(u);var x=B(u,2),b=A(x,!0);P(x),P(a),V(a,f=>C(s,f),()=>r(s)),me(()=>{xe(a,`top: ${g.y??""}px; left: ${g.x??""}px; background: ${(p()?"#F7D9C4":i)??""};`),de(o,d()),de(b,h())}),F(t,a),se()}ae(["mousedown","click"]);var gt=(t,e)=>C(e,"upload"),ht=O("<button>Save</button> <button>Load</button>",1),pt=(t,e)=>C(e,"main"),mt=O('<form class="form svelte-6pag8s"><button>Back</button> <input type="file"> <button type="submit">Load</button></form>'),_t=O('<div class="menu svelte-6pag8s"><!></div>');function yt(t,e){ne(e,!1);let n=S(e,"onFileLoaded",8,()=>{}),s=S(e,"onSaveFile",8,()=>{}),c=L("main"),d=L(null);const h=()=>{if(r(d))if(r(d).files&&r(d).files.length>0){const g=r(d).files[0],a=new FileReader;a.onload=u=>{var x;const o=(x=u.target)==null?void 0:x.result;r(d)&&q(d,r(d).value=""),n()(o)},a.readAsText(g)}else console.warn("No file selected")};te();var _=_t(),p=A(_);{var m=g=>{var a=ht(),u=Ge(a);u.__click=[function(...x){var b;(b=s())==null||b.apply(this,x)}];var o=B(u,2);o.__click=[gt,c],F(g,a)},i=(g,a)=>{{var u=o=>{var x=mt(),b=A(x);b.__click=[pt,c];var f=B(b,2);V(f,y=>C(d,y),()=>r(d)),qe(2),P(x),We("submit",x,h),F(o,x)};ce(g,o=>{r(c)==="upload"&&o(u)},a)}};ce(p,g=>{r(c)==="main"?g(m):g(i,!1)})}P(_),F(t,_),se()}ae(["click"]);const xt=t=>{const e=JSON.stringify(t),n=new Blob([e],{type:"application/json"}),s=document.createElement("a");s.href=URL.createObjectURL(n),s.download="data.json",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(s.href)};var bt=O('<meta name="description" content="Json tree editor">'),wt=O('<div class="main-canvas svelte-1nyn24s"><!> <canvas class="backdrops svelte-1nyn24s"></canvas> <div class="container-background svelte-1nyn24s"><div class="main-container svelte-1nyn24s"></div></div></div>');function Rt(t,e){ne(e,!1);let n=L(),s=L(),c=null;const d=()=>{if(!r(n)||!r(s))return;const v=r(s).getBoundingClientRect();q(n,r(n).width=v.width),q(n,r(n).height=v.height)},h=v=>{if(!r(n)||!r(s))return;const l=r(n).getContext("2d");if(!l)return;const w=[],I=[],M=[],j=[];l.clearRect(0,0,r(n).width,r(n).height),l.beginPath();for(let N of v){if(!r(m)[N.id])continue;const W=[N.mother,N.father].filter(K=>K!==null),Ce=ve(r(m)[N.id],_.position);let Se=w,Ee=I,z=null;const R=W.map(K=>ve(r(m)[K],_.position));R.length===2?(Se.push({start:R[0],end:R[1]}),z=ct(R[0],R[1])):R.length===1&&(z=R[0]),z&&Ee.push({start:z,end:Ce})}G(w,l,"#C9E4DE"),G(I,l,"#DBCDF0"),G(M,l,"#F7D9C4"),G(j,l,"#F7D9C4")},_=new we;let p=L([]);const m=L({}),i=v=>{console.log(v)},g=v=>{at(),ot(v),C(p,v.map(l=>l.item)),rt(r(p))},a=v=>{try{const l=JSON.parse(v);Array.isArray(l)?g(l):alert("Invalid JSON data")}catch(l){alert(`Error parsing JSON: ${l}`)}},u=()=>{const v=r(p).map(l=>{const w=window.getComputedStyle(r(m)[l.id]);return{item:l,position:{x:parseInt(w.left),y:parseInt(w.top)}}});xt(v)};_e(()=>{window.addEventListener("resize",d),window.addEventListener("mousemove",()=>{h(r(p))}),d();const v=it();v&&(C(p,v),h(r(p)))}),Qe(()=>{}),te();var o=wt();Ke(v=>{var l=bt();Ve.title="json editor",F(v,l)}),o.__mousedown=function(...v){var l;(l=_.startDrag)==null||l.apply(this,v)};var x=A(o);yt(x,{onFileLoaded:a,onSaveFile:u});var b=B(x,2);V(b,v=>C(n,v),()=>r(n));var f=B(b,2),y=A(f);$e(y,5,()=>r(p),v=>v.id,(v,l)=>{const w=fe(()=>c===r(l).id);ft(v,{setElementRef:I=>q(m,r(m)[r(l).id]=I),onCardSelected:i,get cardSelected(){return r(w)},get id(){return r(l).id},get name(){return r(l).name},get job(){return r(l).job},get gender(){return r(l).gender}})}),P(y),P(f),P(o),V(o,v=>C(s,v),()=>r(s)),me(()=>xe(y,`translate: ${_.x??""}px ${_.y??""}px;`)),F(t,o),se()}ae(["mousedown"]);export{Rt as component,It as universal};
